# 分页功能说明

## 功能概述

为了更好地处理大量图片的扫描结果，新增了分页显示功能。现在可以分批查看相似图片组，提升页面加载速度和用户体验。

## 功能特性

### 1. 灵活的分页设置

- **默认每页**: 100 组相似图片
- **可选页面大小**: 50、100、200、500 组
- **智能分页**: 自动计算总页数
- **实时切换**: 更改页面大小后自动重新加载

### 2. 完善的分页控件

**顶部和底部双分页器**
- 页面顶部：方便开始浏览时快速切换
- 页面底部：浏览完当前页后无需滚动即可翻页

**分页控件功能**
- 总数显示：显示总共找到多少组相似图片
- 页码选择：快速跳转到指定页
- 上一页/下一页：顺序浏览
- 页面大小选择：根据需要调整每页显示数量
- 快速跳转：输入页码直接跳转

### 3. 移动端适配

- 响应式布局自动适配手机屏幕
- 优化按钮大小和间距
- 分页控件自动换行
- 简化移动端显示，保持可用性

## 使用方法

### 基本操作

1. **扫描完成后查看结果**
   ```
   扫描完成 → 查看结果 → 看到分页控件
   ```

2. **切换页面**
   - 点击页码直接跳转
   - 使用"上一页"/"下一页"按钮
   - 输入页码后按回车跳转

3. **调整每页显示数量**
   - 点击页面大小下拉框
   - 选择 50、100、200 或 500
   - 自动重新加载第一页

### 分页信息显示

```
找到 1500 组相似图片，共 4500 张图片

[总计 1500] [每页 100 条] [<] [1] [2] [3] ... [15] [>] [跳至 ___ 页]
```

## API 接口说明

### 后端接口

**获取相似图片组（分页）**
```http
GET /api/scan/groups/{task_id}?page=1&page_size=100
```

**参数说明：**
- `task_id`: 扫描任务 ID（必填）
- `page`: 页码，从 1 开始（默认 1）
- `page_size`: 每页数量（默认 100，范围 1-500）

**响应示例：**
```json
{
  "task_id": 1,
  "total_groups": 1500,
  "total_pages": 15,
  "current_page": 1,
  "page_size": 100,
  "groups": [
    {
      "group_id": 1,
      "images": [...]
    }
  ]
}
```

### 前端 API 调用

```javascript
// 获取第 1 页，每页 100 组
scanAPI.getSimilarGroups(taskId, 1, 100)

// 获取第 2 页，每页 200 组
scanAPI.getSimilarGroups(taskId, 2, 200)
```

## 性能优化

### 后端优化

1. **内存分片**
   - 只返回当前页数据，不一次性加载所有结果
   - 减少内存占用和网络传输

2. **分页计算**
   ```python
   total_pages = (total_groups + page_size - 1) // page_size
   start_idx = (page - 1) * page_size
   end_idx = start_idx + page_size
   page_groups = groups[start_idx:end_idx]
   ```

### 前端优化

1. **按需加载**
   - 只加载当前页数据
   - 切换页面时重新请求

2. **平滑滚动**
   - 切换页面后自动滚动到顶部
   - 使用平滑滚动效果

3. **状态管理**
   - 记录当前页码和页面大小
   - 支持前进后退浏览器操作

## 实际使用场景

### 场景 1: 大量图片扫描

**问题：** 扫描了 10000 张图片，找到 2000 组相似图片

**解决方案：**
1. 默认每页显示 100 组
2. 共 20 页，每页加载速度快
3. 可以逐页审查，不会卡顿

### 场景 2: 快速浏览

**问题：** 只想快速浏览，一次看更多

**解决方案：**
1. 将页面大小改为 500
2. 减少翻页次数
3. 适合高性能设备

### 场景 3: 精细处理

**问题：** 需要仔细检查每组图片

**解决方案：**
1. 将页面大小改为 50
2. 每页图片少，更容易专注
3. 适合移动端浏览

## 配置说明

### 修改默认页面大小

编辑 [frontend/src/views/ResultPage.vue:122](frontend/src/views/ResultPage.vue#L122)

```javascript
const pageSize = ref(100)  // 修改默认值
```

### 修改页面大小选项

编辑 [frontend/src/views/ResultPage.vue:39](frontend/src/views/ResultPage.vue#L39)

```vue
:page-sizes="[50, 100, 200, 500]"  // 修改可选值
```

### 修改最大页面大小限制

编辑 [backend/app/api/scan.py:126](backend/app/api/scan.py#L126)

```python
if page_size < 1 or page_size > 500:  # 修改最大值
```

## 技术细节

### 前端实现

**关键代码片段：**

```vue
<!-- 分页控件 -->
<el-pagination
  :current-page="currentPage"
  :page-size="pageSize"
  :page-sizes="[50, 100, 200, 500]"
  :total="totalGroups"
  :background="true"
  layout="total, sizes, prev, pager, next, jumper"
  @current-change="handlePageChange"
  @size-change="handleSizeChange"
/>
```

**事件处理：**

```javascript
// 页码变化
const handlePageChange = (page) => {
  currentPage.value = page
  loadResults()
  window.scrollTo({ top: 0, behavior: 'smooth' })
}

// 页面大小变化
const handleSizeChange = (size) => {
  pageSize.value = size
  currentPage.value = 1
  loadResults()
}
```

### 后端实现

**分页逻辑：**

```python
# 计算分页
total_groups = len(groups)
total_pages = (total_groups + page_size - 1) // page_size

# 获取当前页数据
start_idx = (page - 1) * page_size
end_idx = start_idx + page_size
page_groups = groups[start_idx:end_idx]
```

## 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+
- ✅ 移动端浏览器（iOS Safari, Chrome Mobile）

## 注意事项

1. **页码范围**
   - 页码必须在 1 到总页数之间
   - 超出范围会自动调整

2. **页面大小限制**
   - 最小 1 条
   - 最大 500 条
   - 建议使用预设值

3. **性能考虑**
   - 页面大小越大，加载时间越长
   - 移动端建议使用 50-100
   - 桌面端可以使用 100-200

4. **数据一致性**
   - 切换页面时，选中的图片状态会保留
   - 删除图片后会自动刷新当前页

## 故障排查

### 问题 1: 分页控件不显示

**原因：** 总数少于等于一页

**解决：** 分页控件只在总页数大于 1 时显示

### 问题 2: 切换页面后图片没有加载

**检查：**
1. 浏览器控制台是否有错误
2. 网络请求是否成功
3. 后端日志是否有异常

### 问题 3: 移动端分页控件显示异常

**解决：** 已添加响应式样式，检查浏览器版本

## 后续优化建议

1. **虚拟滚动**
   - 实现无限滚动加载
   - 减少分页操作

2. **缓存机制**
   - 缓存已加载的页面
   - 减少重复请求

3. **预加载**
   - 预加载下一页数据
   - 提升切换速度

4. **URL 同步**
   - 将页码保存到 URL
   - 支持分享和书签

---

**更新时间**: 2025-12-05
**版本**: v1.2.0
